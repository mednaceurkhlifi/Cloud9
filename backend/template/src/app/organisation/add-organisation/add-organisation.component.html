<p-toolbar styleClass="mb-6">
  <ng-template #start>
    <p-button label="New Organization" icon="pi pi-plus" severity="secondary" class="mr-2" (onClick)="openNew()" />
    <ng-template #end>
      <span class="p-input-icon-left">
        <i class="pi pi-search"></i>
        <input
          type="text"
          pInputText
          placeholder="Search..."
          [(ngModel)]="searchText"
          (input)="filterOrganizations()"
          style="width: 300px;"
        />
      </span>
    </ng-template>

  </ng-template>
</p-toolbar>

<p-table
  [value]="activeOrganizations"
  [rows]="rows"
  [paginator]="true"
  [totalRecords]="totalOrganizations"
  (onPage)="onPageChange($event)"
  [rowsPerPageOptions]="[10, 20, 30]"
  [globalFilterFields]="['name', 'email', 'phone_number' , 'address']"
  [(selection)]="selectedOrganizations"
  [tableStyle]="{ 'min-width': '75rem' }"
>
  <ng-template pTemplate="header">
    <tr>
      <th>Image</th>
      <th>Name</th>
      <th>Email</th>
      <th>Phone</th>
      <th>Address</th>
      <th>Actions</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-org>
    <tr class="organization-row">
      <td>
        <img
          *ngIf="org.image"
          [src]="'http://localhost:8082/api/v1/organisations/images/' + org.image"
          alt="Image de l'organisation"
          style="width: 100px; height: 100px; object-fit: cover;"
        />
      </td>
      <td>{{ org.name }}</td>
      <td>{{ org.email }}</td>
      <td>{{ org.phone_number }}</td>
      <td>{{ org.address }}</td>
      <td>
        <p-button icon="pi pi-pencil" class="mr-2" (click)="editOrganization(org)" />
        <p-button icon="pi pi-trash" severity="danger" (click)="deleteOrganization(org)" />
        <p-button
          label="Details"
          icon="pi pi-info-circle"
          class="p-button-rounded p-button-info"
          [routerLink]="['/Organisation/offices', org.organization_id]"
          [disabled]="org.is_deleted"
        ></p-button>
      </td>
    </tr>
  </ng-template>
</p-table>

<p-dialog [(visible)]="productDialog" [style]="{ width: '450px' }" header="Organization Details" [modal]="true">
  <ng-template pTemplate="content">
    <div class="flex flex-col gap-4">
      <!-- Name -->
      <div>
        <label for="name" class="block font-bold mb-2">Name</label>
        <input type="text" pInputText id="name" [(ngModel)]="organization.name" name="name" required />
        <small class="text-red-500" *ngIf="submitted && !organization.name">Name is required.</small>
      </div>

      <!-- Email -->
      <div>
        <label for="email" class="block font-bold mb-2">Email</label>
        <input type="email" pInputText id="email" [(ngModel)]="organization.email" name="email" required />
        <small class="text-red-500" *ngIf="submitted && !organization.email">Email is required.</small>
        <small class="text-red-500" *ngIf="submitted && organization.email && !isValidEmail(organization.email)">
          Email format is invalid.
        </small>
      </div>

      <!-- Phone -->
      <div>
        <label for="phone_number" class="block font-bold mb-2">Phone</label>
        <input type="text" pInputText id="phone_number" [(ngModel)]="organization.phone_number" name="phone_number" required pattern="^[0-9]{8,15}$" />
        <small class="text-red-500" *ngIf="submitted && !organization.phone_number">Phone is required.</small>
        <small class="text-red-500" *ngIf="submitted && organization.phone_number && !isValidPhone(organization.phone_number)">
          Phone format is invalid.
        </small>
      </div>

      <!-- Address -->
      <div>
        <label for="address" class="block font-bold mb-2">Address</label>
        <textarea id="address" pTextarea [(ngModel)]="organization.address" name="address" rows="3" required></textarea>
        <small class="text-red-500" *ngIf="submitted && !organization.address">Address is required.</small>
      </div>

      <!-- Image -->
      <div>
        <label for="image" class="block font-bold mb-2">Image</label>
        <input type="file" (change)="onImageSelected($event)" />
        <div *ngIf="organization.image">
          <img [src]="'http://localhost:8082/api/v1/organisations/images/' + organization.image" alt="Preview Image" style="width: 100px; height: 100px; object-fit: cover;" />
        </div>
      </div>
    </div>
  </ng-template>

  <ng-template pTemplate="footer">
    <p-button label="Cancel" icon="pi pi-times" text (click)="hideDialog()" />
    <p-button label="Save" icon="pi pi-check" (click)="saveOrganization()" />
  </ng-template>
</p-dialog>


<p-toast></p-toast>